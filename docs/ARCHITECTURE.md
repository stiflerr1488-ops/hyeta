# Архитектура и техдизайн

## Вариант 1 (Десктоп, рекомендовано): Electron + Vanilla JS
**Плюсы:**
- Нативный доступ к файловой системе.
- Надёжная офлайн-работа.
- Быстрый путь к MVP.

**Минусы:**
- Более тяжёлый рантайм по сравнению с Tauri.

## Вариант 2 (Веб): Next.js/React + File System Access API
**Плюсы:**
- Быстрый веб-онбординг, проще публиковать обновления.

**Минусы:**
- Ограничения API/разрешений в браузерах.
- Хуже контроль исполнения стороннего JS и офлайн-сценариев.

## Модули
- Импорт/индексатор: скан файлов, построение дерева, выделение HTML-страниц.
- Парсер/движок правок: DOM-правки текста и атрибутов.
- Песочница рендеринга: iframe + протокол appfs.
- Панель свойств: редактирование текста, href/src/alt/title.
- Поиск: поиск по текстовым файлам наподобие grep.
- История: стеки отмены/повтора.
- Плагины/фишки (архитектурно): feature-toggle + хуки превью/сравнения.

## Безопасность
- Изоляция рендера: `contextIsolation=true`, `sandbox=true`, `nodeIntegration=false`.
- Песочница iframe для превью: `allow-scripts allow-same-origin allow-forms`.
- Блокировка сети: запрет внешних URL (разрешены только appfs/data/blob).
- Безопасность путей: нормализация путей и запрет выхода за корень проекта.

## Модель данных
- `ProjectIndex`: `{ tree, htmlPages }`
- `FileNode`: directory | file
- `SearchResult`: `{ path, line, snippet }`
- Runtime-state: текущая страница, выбранный selector, текущий контент, стеки отмены/повтора.

## Стратегия изменения файлов
- MVP: DOM-разбор в renderer и сохранение документа обратно в файл.
- v1: гибрид DOM + AST (parse5/rehype) для лучшего сохранения форматирования/комментариев.

## Версионирование
- MVP: локальные снимки + отмена/повтор.
- v1: опциональная git-интеграция, diff/patch и откат по операции/проекту.
<!-- updated-all-files -->
